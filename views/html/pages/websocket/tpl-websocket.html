{{ define "pages/websocket/tpl-websocket.html" }}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试websocket</title>
</head>
<body>
<h4>测试websocket，请在控制台查看结果。</h4>
<p id="msg-send">???</p>
<p id="msg-write"></p>
<script>

      function socket(ws){

          // 连接打开时触发
          ws.onopen = function(evt) {
              console.log("打开连接 >>> " + evt.currentTarget.url);
              console.log("WebSocket type=" + evt.type);
              //
              let msg = "name=张三@id=2021";
              document.getElementById("msg-send").innerHTML = "发送消息：" + msg;
              //
              ws.send(msg);
          };

          // 接收到消息时触发
          ws.onmessage = function(evt) {
              console.log("WebSocket type=" + evt.type);
              //
              let msg = evt.data
              let p = document.createElement("p")
              p.innerHTML = "收到消息：" + msg;
              document.getElementById("msg-write").append(p)
              //
              console.log("收到消息: " + msg);
          };

          // 连接关闭时触发
          ws.onclose = function(evt) {
              console.log("连接关闭。。。");
              console.log("WebSocket type = " + evt.type);
          };

      }

      (function (){

          // 创建连接
          const api = "ws://127.0.0.1:8090/api/"; // wss://
          let ws = new WebSocket(api + "example/socket/ping1");

          //
          socket(ws)

      })();



</script>
</body>
</html>

{{ end }}